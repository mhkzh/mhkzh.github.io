<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <!-- BEGIN HEAD -->

    <head>
        <meta charset="utf-8" />
        <title>销售渠道管理</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <meta content="" name="description" />
        <meta content="" name="author" />
        <!-- 开始全局强制的样式 -->
        <link href="../assets/global/plugins/font-awesome/css/font-googleapis.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束全局强制的样式 -->
        <!-- 开始全局的主题风格 -->
        <link href="../assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
        <link href="../assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束全局的主题风格 -->
        <!-- 开始主题布局风格 -->
        <link href="../assets/layouts/layout/css/layout2.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/layouts/layout/css/themes/darkblue.min.css" rel="stylesheet" type="text/css" id="style_color" />
        <link href="../assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束主题布局风格 -->
        <!-- 开始页面级别的插件 -->				
        <link href="../assets/global/plugins/JqGrid/css/ui.jqgrid-bootstrap.css" rel="stylesheet"></link>
        <link href="../assets/pages/scripts/DatePicker/skin/WdatePicker.css" rel="stylesheet"></link>
        <link href="../assets/global/plugins/jquery-ui-bootstrap/jquery-ui-1.10.0.custom.css" rel="stylesheet" />
        <!-- 结束页面级别的插件 -->	
        <link rel="shortcut icon" href="favicon.ico" /> </head>
    <!-- END HEAD -->

        <body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
   
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE BAR -->
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <a href="index.html">首页</a>
                                <i class="fa fa-circle"></i>
                            </li>
                             <li>
                                <span>销售渠道管理</span>
                                 <i class="fa fa-circle"></i>
                            </li>
                            <li>
                                <span>销售渠道管理</span>
                            </li>
                        </ul>
                    </div>
                    <div class="portlet light bordered">
                         <div class="portlet-title">
                            <div class="caption font-dark">
                                 <i class="icon-settings font-dark"></i>
                                 <span class="caption-subject bold uppercase">销售渠道管理</span>
                             </div>
                             <div class="tools"> 
                             <button type="button" class="btn blue-hoki btn-outline sbold uppercase">同步商户信息</button>
                             </div>
                     </div>
                     <table>
                     <tr>
                     <td>
                     <span>智能提示/自动补全：</span>
                     </td>
                     <td>
                     <input class="form-control"  style="width:200px;" id="search" aria-controls="sample_1" type="search" placeholder=""/>
                     </td>
                     <td>
                      &nbsp;
                     <span>状态：</span>
                     </td>
                     <td>
                     <select id="qdState" class="form-control" style="width:120px;">
                     <option value="">全部</option>
				     </select>
                     </td>
                     <td>
                     &nbsp;
                      <button type="button" class="btn blue-hoki btn-outline sbold uppercase" onclick="search();">查询</button>
                     </td>
                     </tr>
                     </table>
                     <div class="portlet-body">
                         <ul class="nav nav-tabs">
                                        <li class="active">
                                            <a href="#tab_1_1" data-toggle="tab"> JQGrid </a>
                                        </li>
                                        <li>
                                            <a href="#tab_1_2" data-toggle="tab"> HighChart </a>
                                        </li>
                                    </ul>
                                    <div class="tab-content">
                                        <div class="tab-pane fade active in" id="tab_1_1">
											<table id="list"></table>
											<div id="listPager"></div>
                                        </div>
                                        <div class="tab-pane fade" id="tab_1_2">
                                           	<div id="container" ></div>
                                        </div>
                                    </div>
					 </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- 冻结渠道弹出框 -->
            <div class="modal fade bs-modal-sm" id="freezeChannelDj" tabindex="-1" role="dialog" aria-hidden="true">
                 <div class="modal-dialog modal-sm">
                 <div class="modal-content">
                 <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                 <h4 class="modal-title">确认</h4>
                 </div>
                 <div class="modal-body">您确定要冻结此渠道吗？</div>
                 <div class="modal-footer">
                 <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                 <button type="button" class="btn green" onclick="freeze();">确定</button>
                 </div>
                 </div>
                 <!-- /.modal-content -->
                 </div>
                 <!-- /.modal-dialog -->
           </div>
           <!-- 激活渠道弹出框 -->
            <div class="modal fade bs-modal-sm" id="freezeChannelJh" tabindex="-1" role="dialog" aria-hidden="true">
                 <div class="modal-dialog modal-sm">
                 <div class="modal-content">
                 <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                 <h4 class="modal-title">确认</h4>
                 </div>
                 <div class="modal-body">您确定要激活此渠道吗？</div>
                 <div class="modal-footer">
                 <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                 <button type="button" class="btn green" onclick="activate();">确定</button>
                 </div>
                 </div>
                 <!-- /.modal-content -->
                 </div>
                 <!-- /.modal-dialog -->
           </div>
           <!-- 编辑渠道弹出框 -->
           <div class="modal fade draggable-modal" id="editChannel" tabindex="-1" role="dialog" aria-hidden="true">
                 <div class="modal-dialog">
                 <div class="modal-content">
                 <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                 <h4 class="modal-title">销售渠道配置</h4>
                 </div>
                 <table class="table table-bordered">
				  <tbody>
				    <tr>
				      <td align="right">访问密钥:</td>
				      <td align="left"><input name="endTextBox" type="text"  value="8sd1dksad" id="key"  style="width:150px;" disabled="disabled"/>
				      <button class="btn blue-hoki btn-outline sbold uppercase" >自动生成</button> 
				      </td>
				    </tr>
				    <tr>
				      <td align="right">单笔手续费:</td>
				      <td align="left" colspan="3"><input name="tbx_short2" type="text" id="handlingCharge" style="width:100px;" />
					  <span id="isNull" style="color:red;font-family:微软雅黑,宋体">*</span>
					</td>
				    </tr>
				    <tr>
				      <td align="right">有效期:</td>		
				      <td colspan="3">
				     <input id="startTime" name="startTime"  class="Wdate"  id="startTime" style="height:26px;" type="text" onFocus="WdatePicker({skin:'whyGreen',dateFmt:'yyyy-MM-dd HH:mm:ss',isShowClear:true,maxDate:'#F{$dp.$D(\'endTime\')}'})"/>
				      -
				     <input id="endTime" name="endTime"  class="Wdate" id="endTime" style="height:26px;" type="text"  onFocus="WdatePicker({skin:'whyGreen',dateFmt:'yyyy-MM-dd HH:mm:ss',isShowClear:true,minDate:'#F{$dp.$D(\'startTime\')}'})"/>
				     <span id="yxqIsNull" style="color:red;font-family:微软雅黑,宋体">*</span>
				     </td>		
				    </tr>
				  </tbody>
				</table>
                 <div class="modal-footer">
                 <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                 <button type="button" class="btn green" onclick="save();">保存</button>
                 </div>
                 </div>
                 <!-- /.modal-content -->
                 </div>
                 <!-- /.modal-dialog -->
           </div>
           
        <!-- END CONTENT -->
        <!-- END CONTAINER -->
        <!--[if lt IE 9]>
<script src="../assets/global/plugins/respond.min.js"></script>
<script src="../assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
        <!-- 开始核心插件 -->
        <script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        <!-- 结束核心插件 -->
        <!-- 开始页面级别的插件 -->
        <script src="../assets/global/plugins/JqGrid/jquery.jqGrid.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/JqGrid/grid.locale-en.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/JqGrid/formatDate.js" type="text/javascript"></script>
        <script src="../assets/global/common/common.js" type="text/javascript"></script><!-- 所有页面都要用到的工具类 -->
        <script src="../assets/global/plugins/jquery-ui-bootstrap/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/DatePicker/WdatePicker.js" type="text/javascript" ></script>
        <script src="../assets/global/plugins/highcharts/js/highcharts.js" type="text/javascript" ></script>
        <script src="../assets/global/plugins/highcharts/js/modules/exporting.js" type="text/javascript" ></script>
        <!-- 结束页面级别的插件 -->
        <!-- 开始项目级别的主题-->			
        <script src="../assets/global/scripts/app.min.js" type="text/javascript"></script>
        <!-- 结束项目级别的主题 -->
        <!-- 开始页面级别的脚本 -->
        <!-- 结束页面级别的脚本 -->
        <!-- 开始主题布局脚本 -->
        <script src="../assets/layouts/layout/scripts/layout.min.js" type="text/javascript"></script>
        <script src="../assets/layouts/layout/scripts/demo.min.js" type="text/javascript"></script>
        <script src="../assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
        <!-- 结束主题布局脚本 -->
        <script type="text/javascript">

   
        $(function(){
        	//自加载,通过ajax从数据库字典表中获取状态信息用于jqGrid做判断，
        	//注意：类似这种信息不要写死，都要在字典表中维护，后期数据接入直接修改表中数据即可
        	//从字典表中获取状态的对应关系
			// getDictionary(); 
        	// getAllName();//从数据库中取出所有的销售渠道名称，用于搜索框智能/自动补全
        	list(); 
        	autoFill();
        	//EChart();
        	HighChart();
        });
        
        //自动补全
        function autoFill(){
            var availableTags = ["万达WEB", "万达Android", "万达ios", "猫眼",
                                 "微票儿", "格瓦拉", "百度糯米", "淘宝电影", "ColdFusion",
                                 "Erlang", "Fortran","Groovy", "Haskell", "Java",
                                 "JavaScript", "Lisp", "Perl", "PHP", "Python", 
                                 "Ruby", "Scala", "Scheme"];
            $("#search").autocomplete({
                source: availableTags
            });
        }
        
        var w = $(window).width() - 80; //父窗口宽度减去侧滑菜单
        //加载表格
        function list(){
        	//获取页面的高度
        	//获取页面的宽度		
            $("#list").jqGrid({
                //mtype: "POST",
    			postData:{"cannelName":$("#search").val()},
				styleUI : 'Bootstrap',
                datatype: "json",
                url: 'JSON.txt',		
                //sortname: xxx, 默认的排序列
                colModel: [
                    {label: 'id', name: 'id',hidden:true},
                    {label: '总部内部编号',name:'internalNumber',align:'center',width: 135},
                    {label: '销售渠道名称',name:'cannelName',align:'center',width: 135},
                    {label: '单笔手续费',name:'singleFee',align:'center',width: 135},
                    {label: '状态', name: 'state',align:'center',width:85},
                    {label: '访问密钥',name:'visitKey',align:'center',width: 135},
                    {label: '激活时间',name:'activationTime',align:'center',width: 180,formatter:actFormat},
                    {label: '冻结时间',name:'freezingTime',align:'center', width: 180,formatter:freeFormat},
                    {label: '操作',name:'opt',width:115,align:'center',formatter:opt}
                ],
				viewrecords: true,
                height: 400,
                width:w,
                rowNum: 10, //每页显示记录数  
                rowList:[10,20,30],
                pager: "#listPager", //分页工具栏
                loadComplete: function(){
                
                }
            });
        }
        
        //格式化激活时间
        function actFormat(el, cellval, opts){
        	if(opts.activationTime != null){
        	return dateFormat(opts.activationTime);
        	}else{
        	return "";
        	}
        }
        			
        //格式化冻结时间
        function freeFormat(el, cellval, opts){
        	if(opts.freezingTime != null){
        	return dateFormat(opts.freezingTime);
        	}else{
        	return "";
        	}
        }
        

        //重写list操作
        function opt(el, cellval, opts){
    	var edit = "<button type=\"button\" class=\"btn blue-hoki btn-xs\" data-toggle=\"modal\" href=\"#editChannel\" onclick=\"selectRowData('"+opts.id+"','"+opts.internalNumber+"','"+opts.cannelName+"','"+opts.singleFee+"','"+opts.state+"','"+opts.visitKey+"','"+activationTime+"','"+freezingTime+"','"+opts.validTmBegin+"','"+opts.validTmEnd+"')\">编辑</button>";
		return edit;
		}
        
        //记录用户选择的行数据
        var id = "";             //id
        var internalNumber = ""; //总部内部编号
        var cannelName = "";     //销售渠道名称
        var singleFee = "";      //单笔手续费
        var state = "";          //状态
        var visitKey = "";       //访问密钥
        var activationTime = "";  //激活时间
        var freezingTime = "";    //激活时间
        var validTmBegin = "";    //有效期开始时间
        var validTmEnd = "";      //有效期结束时间
        
        //获取用户点击行的数据
        function selectRowData(Rid,RinternalNumber,RcannelName,RsingleFee,Rstate,RvisitKey,RactivationTime,RfreezingTime,RvalidTmBegin,RvalidTmEnd){
        	id = Rid;		
        	internalNumber = RinternalNumber;
        	cannelName = RcannelName;
        	singleFee = RsingleFee;
        	state = Rstate;
        	visitKey = RvisitKey;
        	activationTime = RactivationTime;
        	freezingTime = RfreezingTime;		
        	if(RvalidTmBegin != "undefined" && RvalidTmBegin != null && RvalidTmBegin != ""){
        		validTmBegin = dateFormat(parseInt(RvalidTmBegin));
        		$("#startTime").val(validTmBegin);
        	}else{
        		$("#startTime").val("");
        	}
        	if(RvalidTmEnd != "undefined" && RvalidTmEnd != null & RvalidTmEnd != ""){
        		validTmEnd = dateFormat(parseInt(RvalidTmEnd));
        		$("#endTime").val(validTmEnd);
        	}else{
        		$("#endTime").val("");
        	}
        	$("#key").val(visitKey);
        	$("#handlingCharge").val(singleFee);
        }
        
        //根据查询条件进行查询
        function search(){
			$("#list").jqGrid('setGridParam',{
			    url: apiUrl+pName+'/saleChannel/sellchannelManage.htm',
				postData:{"cannelName":$("#search").val(),
						  "state":$("#qdState option:selected").val()
				},
				page:1 //从第一页开始
			 }).trigger("reloadGrid"); 
        }
        
       //HighChart Demo演示
       function HighChart(){
    	   Highcharts.setOptions({
               lang: {
                  　 printChart:"打印图表",
                     downloadJPEG: "下载JPEG 图片" , 
                     downloadPDF: "下载PDF文档"  ,
                     downloadPNG: "下载PNG 图片"  ,
                     downloadSVG: "下载SVG 矢量图" , 
                     exportButtonTitle: "导出图片" 
               }
           });
    	   
    	   var chart = new Highcharts.Chart({  
			     chart: {  
			        //将报表对象渲染到层上  
			        renderTo: 'container',
			        width:w
			     }, 
    	        title: {
    	            text: 'HighChart DEMO 可参考，去除了版本标识，汉化了导出文字',
    	            x: -20 //center
    	        },
    	        subtitle: {
    	            text: '来源: 北京影合众新媒体技术服务有限公司',
    	            x: -20
    	        },
    	        xAxis: {
    	            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun','Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
    	        },
    	        yAxis: {
    	            title: {
    	                text: 'Temperature (°C)'
    	            },
    	            plotLines: [{
    	                value: 0,
    	                width: 1,
    	                color: '#808080'
    	            }]
    	        },
    	        tooltip: {
    	            valueSuffix: '°C'
    	        },
    	        legend: {
    	            layout: 'vertical',
    	            align: 'right',
    	            verticalAlign: 'middle',
    	            borderWidth: 0
    	        },
    	        credits:{
    	            enabled:false // 禁用版权信息
    	        },
    	        series: [{
    	            name: 'Tokyo',
    	            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    	        }, {
    	            name: 'New York',
    	            data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
    	        }, {
    	            name: 'Berlin',
    	            data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
    	        }, {
    	            name: 'London',
    	            data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
    	        }]
    	    });
       }
        </script>
    </body>

</html>