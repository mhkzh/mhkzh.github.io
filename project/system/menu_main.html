<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <!-- BEGIN HEAD -->

    <head>
        <meta charset="utf-8" />
        <title>菜单管理</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <meta content="" name="description" />
        <meta content="" name="author" />
        <!-- 开始全局强制的样式 -->
        <link href="../assets/global/plugins/font-awesome/css/font-googleapis.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束全局强制的样式 -->
        <!-- 开始全局的主题风格 -->
        <link href="../assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
        <link href="../assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束全局的主题风格 -->
        <!-- 开始主题布局风格 -->
        <link href="../assets/layouts/layout/css/layout2.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/layouts/layout/css/themes/darkblue.min.css" rel="stylesheet" type="text/css" id="style_color" />
        <link href="../assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
        <!-- 结束主题布局风格 -->
        <!-- 开始页面级别的插件 -->				
        <link href="../assets/global/plugins/JqGrid/css/ui.jqgrid-bootstrap.css" rel="stylesheet"></link>
        <link href="../assets/pages/scripts/DatePicker/skin/WdatePicker.css" rel="stylesheet"></link>
        <link href="../assets/global/plugins/jquery-ui-bootstrap/jquery-ui-1.10.0.custom.css" rel="stylesheet" />
        <!-- 结束页面级别的插件 -->	
        <link rel="shortcut icon" href="favicon.ico" /> </head>
    <!-- END HEAD -->

        <body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
   
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE BAR -->
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <a href="index.html">首页</a>
                                <i class="fa fa-circle"></i>
                            </li>
                             <li>
                                <span>系统管理</span>
                                 <i class="fa fa-circle"></i>
                            </li>
                            <li>
                                <span>菜单管理</span>
                            </li>
                        </ul>
                    </div>
                    <div class="portlet light bordered">
                         <div class="portlet-title">
                            <div class="caption font-dark">
                                 <i class="icon-settings font-dark"></i>
                                 <span class="caption-subject bold uppercase">菜单管理</span>
                             </div>
                             <div class="tools"> 
                             <button type="button" data-toggle="modal"  href="#MenuDialog" class="btn blue-hoki btn-outline sbold uppercase">新增菜单</button>
                             </div>
                     </div>
                     <table>
                     <tr>
                     <td>
                     <span>菜单名称：</span>
                     </td>
                     <td>
                     <input class="form-control"  style="width:200px;" id="search" aria-controls="sample_1" type="search" placeholder="请输入菜单名称" />
                     </td>
                     <td>
                     &nbsp;
                      <button type="button" class="btn blue-hoki btn-outline sbold uppercase" onclick="search();">查询</button>
                     </td>
                     </tr>
                     </table>
                <div class="portlet-body">
					<table id="list"></table>
					<div id="listPager"></div>
				</div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
           <!-- 新增菜单弹出框 -->
           <div class="modal fade draggable-modal" id="MenuDialog" tabindex="-1" role="dialog" aria-hidden="true">
                 <div class="modal-dialog" style="width:450px;">
                 <div class="modal-content">
                 <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                 <h4 class="modal-title">新增菜单</h4>
                 </div>
                 <table class="table table-bordered">
				  <tbody>
				    <tr>
				      <td align="right">菜单名称:</td>
				      <td align="left">
				      <input name="tbx_short2" type="text" id="handlingCharge" style="width:250px;" />
				      </td>
				    </tr>
				    <tr>
				      <td align="right">菜单编码:</td>
				      <td align="left">
				      <input name="tbx_short2" type="text" id="handlingCharge" style="width:250px;" />
				      </td>
				    </tr>
				    <tr>
				      <td align="right">链接(URL):</td>		
				      <td colspan="3">
				      <input name="tbx_short2" type="text" id="handlingCharge" style="width:250px;" />
				      </td>		
				    </tr>
				    <tr>
				      <td align="right">版本号:</td>		
				      <td colspan="3">
				      <input name="tbx_short2" type="text" id="handlingCharge" style="width:250px;" />
				      </td>		
				    </tr>
				    <tr>		
				      <td align="right">排序:</td>
				      <td align="left" colspan="3">
				      <input name="tbx_short2" type="text" id="handlingCharge" style="width:250px;" />
					</td>
				    </tr>
				    <tr>
				      <td align="right">上级菜单:</td>		
				      <td colspan="3">
				      <select id="parentId" class="form-control" style="width:150px;">
                      <option value="0">无</option>
				      </select>
				      </td>		
				    </tr>
				    <tr>
				      <td align="right">菜单状态:</td>		
				      <td colspan="3">
				      <input type="radio" name="state"/>&nbsp;显示
				      &nbsp;&nbsp;&nbsp;
				      <input type="radio" name="state"/>&nbsp;隐藏
				      </td>		
				    </tr>
				  </tbody>
				</table>
                 <div class="modal-footer">
                 <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                 <button type="button" class="btn green" onclick="save();">保存</button>
                 </div>
                 </div>
                 <!-- /.modal-content -->
                 </div>
                 <!-- /.modal-dialog -->
           </div>
           
        <!-- END CONTENT -->
        <!-- END CONTAINER -->
        <!--[if lt IE 9]>
<script src="../assets/global/plugins/respond.min.js"></script>
<script src="../assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
        <!-- 开始核心插件 -->
        <script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        <!-- 结束核心插件 -->
        <!-- 开始页面级别的插件 -->
        <script src="../assets/global/plugins/JqGrid/jquery.jqGrid.min.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/JqGrid/grid.locale-en.js" type="text/javascript"></script>
        <script src="../assets/global/plugins/JqGrid/formatDate.js" type="text/javascript"></script>
        <script src="../assets/global/common/common.js" type="text/javascript"></script><!-- 所有页面都要用到的工具类 -->
        <script src="../assets/global/plugins/jquery-ui-bootstrap/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
        <!-- 结束页面级别的插件 -->
        <!-- 开始项目级别的主题-->			
        <script src="../assets/global/scripts/app.min.js" type="text/javascript"></script>
        <!-- 结束项目级别的主题 -->
        <!-- 开始页面级别的脚本 -->
        <!-- 结束页面级别的脚本 -->
        <!-- 开始主题布局脚本 -->
        <script src="../assets/layouts/layout/scripts/layout.min.js" type="text/javascript"></script>
        <script src="../assets/layouts/layout/scripts/demo.min.js" type="text/javascript"></script>
        <script src="../assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
        <!-- 结束主题布局脚本 -->
        <script type="text/javascript">

        
        var cinemaCode = "31133407";  //用于测试
   
        $(function(){
        	list();  	//表格
        	autoFill(); //自动补全
        	getMenu();  //获取该影院所含有的全部一级菜单
        });
        
        //自动补全
        function autoFill(){
            var availableTags = ["万达WEB", "万达Android", "万达ios", "猫眼",
                                 "微票儿", "格瓦拉", "百度糯米", "淘宝电影", "ColdFusion",
                                 "Erlang", "Fortran","Groovy", "Haskell", "Java",
                                 "JavaScript", "Lisp", "Perl", "PHP", "Python", 
                                 "Ruby", "Scala", "Scheme"];
            $("#search").autocomplete({
                source: availableTags
            });
        }
        
        
        //获取该影院所含有的全部一级菜单
        function getMenu(){
        	 $.ajax({
                 url: apiUrl+pName+'/systemInfo/getMenuInfoByCinema.htm',
                 timeout: 20000,
                 dataType: "json",
                 async:false,
                 type:"POST",		
                 data: {},		
                 beforeSend: function () {},
                 success: function (data) {
                	 for(var i=0;i<data.length;i++){
                		 $("<option  value='"+data[i].code+"'>"+data[i].name+"</option>").appendTo("#parentId");
                	 }
                 },
                 error:function(XMLHttpRequest,textStatus,errorThrown){}
             });
        }
        
        var w = $(window).width() - 80; //父窗口宽度减去侧滑菜单
        //加载表格
        function list(){
        	//获取页面的高度
        	//获取页面的宽度		
            $("#list").jqGrid({
                mtype: "POST",
                url: apiUrl+pName+'/systemInfo/functionQuery',
    			postData:{
    				"menuName":$("#search").val(),
    				"cinemaCode":cinemaCode
    			},
				styleUI : 'Bootstrap',
                datatype: "json",	
                //sortname: xxx, 默认的排序列
                colModel: [
                    {label: '编码', name: 'code',align:'center',width:80},
                    {label: '名称',name:'name',align:'center',width: 220},
                    {label: 'URL',name:'url',align:'center',width: 210},					
                    {label: '状态值',name:'value',align:'center',width: 80},
                    {label: '父菜单', name: 'parentId',align:'center',width:135},
                    {label: '排序',name:'sort',align:'center',width: 80},
                    {label: '操作',name:'opt',width:115,align:'center',width: 135,formatter:opt}
                ],
				viewrecords: true,
                height: 400,
                width:w,
                rowNum: 10, //每页显示记录数  
                rowList:[10,20,30],
                pager: "#listPager", //分页工具栏
                loadComplete: function(){
                
                }
            });
        }
       
        
        //重写list操作
        function opt(el, cellval, opts){
    	var edit = "<button type=\"button\" class=\"btn blue-hoki btn-xs\" data-toggle=\"modal\" onclick=\"edit('"+opts.id+"')\">编辑</button>";
		return edit;
		}
        
        //编辑菜单
        function edit(id){
        	alert(id);
        }
        
        //根据查询条件进行查询
        function search(){
			$("#list").jqGrid('setGridParam',{
				url: apiUrl+pName+'/systemInfo/functionQuery',
				postData:{"menuName":$("#search").val()
				},
				page:1 //从第一页开始
			 }).trigger("reloadGrid"); 
        }
        
        //新增菜单
        function addMenu(){
        	//$('#editChannel').modal('show');
        }
        
        </script>
    </body>

</html>